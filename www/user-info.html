<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>聚美医</title>
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1453083508_4721825.css">
    <link rel="stylesheet" href="css/framework7.ios.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="css/my-app.css">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="img/android-chrome-192x192.png" sizes="192x192">
    <meta name="msapplication-square70x70logo" content="img/smalltile.png">
    <meta name="msapplication-square150x150logo" content="img/mediumtile.png">
    <meta name="msapplication-wide310x150logo" content="img/widetile.png">
    <meta name="msapplication-square310x310logo" content="img/largetile.png">
</head>
<body>
    <input type="file" id="files" onchange="previewImg()" hidden>
    <div class="navbar">
        <div class="navbar-inner">
            <div class="left"><a href="javascript:history.go(-1)" class="back link"><i class="icon icon-back"></i></a></div>
            <div class="center sliding">完善资料</div>
        </div>
    </div>
    <div class="pages">
        <div data-page="user-info" id="user-info" class="page user-info-list no-tabbar">
            <div class="page-content">
                <div class="list-block">
                    <ul>
                        <li>
                            <a href="#" class="item-link user-avatar">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">头像</div>
                                        <div class="item-media avt"><img id="picsrc" src="img/avt.png" /></div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="item-link user-name">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">姓名</div>
                                        <div class="item-after" id="truename">梁静虹</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="list-block">
                    <ul>
                        <li>
                            <a href="#" class="item-link">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">实名认证</div>
                                        <div class="item-after" id="iscanuse">未认证</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="list-block">
                    <ul>
                        <li>
                            <a href="#" class="item-link user-hospital">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">医院</div>
                                        <div class="item-after" id="hospitalname">陆军总医院</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="item-link user-department">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">科室</div>
                                        <div class="item-after" id="department">皮肤美容科</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="item-link user-title">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">职称</div>
                                        <div class="item-after" id="postname">主任医生</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="list-block">
                    <ul>
                        <li>
                            <a href="javascript:void(0)" onclick="window.location.href='goodat.html'" class="item-link">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">擅长项目</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="window.location.href='user-description.html'" class="item-link">
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">医生简介</div>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/framework7.min.js"></script>
    <!-- Path to your app js-->
    <script type="text/javascript" src="js/my-app.js"></script>
    <script src="Scripts/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="Scripts/FrameJs/global.js"></script>
    <script src="Scripts/FrameJs/frame.ajax.js"></script>
    <script src="Scripts/FrameJs/frame.ajax2.js"></script>
    <script type="text/javascript">
        // Initialize your app
        var myApp = new Framework7();
        // Export selectors engine
        var $$ = Dom7;

       
        var pagedata;
        const doctorsno = localStorage.getItem("doctorSno");

        
        function previewImg() {
            var imgFile = document.getElementById("files").files[0];
            $("#picsrc")[0].src = URL.createObjectURL(document.getElementById("files").files[0]);
            uploadImg();
        }
        function uploadImg() {
            var file =document.getElementById("files").files[0];
            $.Frame.Ajax.AjaxUpload({
                url: $.Frame.Config.Constant.ServerUrl + "Doctor.savedoctorimg.go",
                postdata: {
                    doctorsno: doctorsno,
                    picsrc: file,//$("#files").val() != "" ? document.getElementById("files").files[0] : ""
                },
                contenttype: false,
                processdata: false,
                success: function (rtn) {
                    if (rtn.issuccess) {
                        $.Frame.Message.ShowMsg(rtn.msg);
                    } else {
                        $.Frame.Message.ShowMsg(rtn.msg);
                    }
                }
            })
        }
        window.onload = function () {
            $.Frame.Ajax.Ajax({
                url: $.Frame.Config.Constant.ServerUrl + "doctor.querydoctorinfo.go",
                postdata: {
                    //doctorsno: "1fc0aa39-cd6b-4786-b078-8b4c59cebdc3"
                    doctorsno: doctorsno
                },
                success: function (rtn) {
                    //发送成功
                    if (rtn.issuccess) {
                        pagedata = rtn;
                        $("#truename").text(rtn.data0.truename);
                        $("#postname").text(rtn.data0.postname);
                        $("#hospitalname").text(rtn.data0.workunit);
                        if (rtn.data0.iscanuse == "1"){
                            $("#iscanuse").text("已认证");
                        }
                        else {
                            $("#iscanuse").text("未认证");
                        }
                        $("#department").text(rtn.data0.department);
                        $("#picsrc").attr("src", rtn.data0.picsrc);
                        //myApp.alert("成功!", "提示", function () {
                        //  window.location.href = "index.html";
                        //});
                    } else {
                        pagedata = rtn;
                        myApp.alert(rtn.msg, "提示");
                    }
                },
                async: true
            })           
        }       
        // 头像
        $$('.user-avatar').on('click', function () {
            var buttons1 = [
                {
                    text: '拍照',
                    color: 'black',
                    onClick: function () {
                        myApp.alert('拍照功能');
                        //var pictureSource;      //图片来源 

                        //var destinationType;        //设置返回值的格式 

                        //// 等待PhoneGap连接设备 

                        //document.addEventListener("deviceready", onDeviceReady, false);
                        //// PhoneGap准备就绪，可以使用！ 
                        //function onDeviceReady() {

                        //    pictureSource = navigator.camera.PictureSourceType;

                        //    destinationType = navigator.camera.DestinationType;

                        //}
                        //navigator.camera.getPicture(onSuccess, onFail, {
                        //    quality: 50,
                        //    destinationType: Camera.DestinationType.DATA_URL
                        //});

                        //function onSuccess(imageData) {
                        //    var image = document.getElementById('picsrc');
                        //    image.src = "data:image/jpeg;base64," + imageData;
                        //    //发送ajax请求，将图片存到数据库中


                        //    console.log(image.src);
                        //}

                        //function onFail(message) {
                        //    alert('Failed because: ' + message);
                        //}
                    }
                },
                {
                    text: '从手机相册选择',
                    color: 'black',
                    onClick: function () {
                        $("#files").trigger("click");
                    }
                }
            ];
            var buttons2 = [
                {
                    text: '取消',
                    color: 'black'
                }
            ];
            var groups = [buttons1, buttons2];
            myApp.actions(groups);
        });

        $$('.user-name').on('click', function () {
            var userName = pagedata.data0.truename;
            myApp.modal({
                title: '姓名',
                text: '',
                afterText: '<div class="modal-input-wrap"><input type="text" class="modal-text-input" id="upname" value="' + userName + '"><i class="clear-value iconfont icon-shanchu"></i></div>',
                buttons: [
                {
                    text: '取消'
                },
                {
                    text: '确定',
                    bold: true,
                    onClick: function () {
                        // 保存姓名,发送Ajax请求
                        $.Frame.Ajax.Ajax({
                            url: $.Frame.Config.Constant.ServerUrl + "doctor.savedoctorname.go",
                            postdata: {
                                doctorsno: doctorsno,
                                updatename: $("#upname").val()
                                    
                            },
                            success: function (rtn) {
                                //发送成功
                                if (rtn.issuccess) {
                                    $("#truename").text($("#upname").val());
                                } else {
                                    myApp.alert("修改失败!", "提示");
                                }
                            },
                            async: true
                        })

                    }
                }]
            });
            $$('.modal-input-wrap .clear-value').on('click', function () {
                $$(this).prev().val('');
            });
        });


        $$('.user-hospital').on('click', function () {
            var userHospital = pagedata.data0.workunit;
            myApp.modal({
                title: '医院信息',
                text: '',
                afterText: '<div class="modal-input-wrap"><input type="text" class="modal-text-input" id="updatehospital" value="' + userHospital + '"><i class="clear-value iconfont icon-shanchu"></i></div>',
                buttons: [
                {
                    text: '取消'
                },
                {
                    text: '确定',
                    bold: true,
                    onClick: function () {
                        $.Frame.Ajax.Ajax({
                            url: $.Frame.Config.Constant.ServerUrl + "doctor.savedoctorhospitalname.go",
                            postdata: {
                                doctorsno:localStorage.getItem("doctorSno"),
                                updatehospital: $("#updatehospital").val()
                            },
                            success: function (rtn) {
                                //发送成功
                                if (rtn.issuccess) {
                                    $("#hospitalname").text($("#updatehospital").val());
                                } else {
                                    myApp.alert("修改失败!", "提示");
                                }
                            },
                            async: true
                        })
                    }
                }]
            });
            $$('.modal-input-wrap .clear-value').on('click', function () {
                $$(this).prev().val('');
            });
        });

        $$('.user-department').on('click', function () {
            var userDepartment = pagedata.data0.department;
            myApp.modal({
                title: '科室信息',
                text: '',
                afterText: '<div class="modal-input-wrap"><input type="text" class="modal-text-input" id="updatedepartment" value="' + userDepartment + '"><i class="clear-value iconfont icon-shanchu"></i></div>',
                buttons: [
                {
                    text: '取消'
                },
                {
                    text: '确定',
                    bold: true,
                    onClick: function () {
                        $.Frame.Ajax.Ajax({
                            url: $.Frame.Config.Constant.ServerUrl + "doctor.savedoctordepartment.go",
                            postdata: {
                                doctorsno:localStorage.getItem("doctorSno"),
                                //doctorsno: "1fc0aa39-cd6b-4786-b078-8b4c59cebdc3"
                                updatedepartment: $("#updatedepartment").val()
                            },
                            success: function (rtn) {
                                //发送成功
                                if (rtn.issuccess) {
                                    $("#department").text($("#updatedepartment").val());
                                } else {
                                    myApp.alert("修改失败!", "提示");
                                }
                            },
                            async: true
                        })
                    }
                }]
            });
            $$('.modal-input-wrap .clear-value').on('click', function () {
                $$(this).prev().val('');
            });
        });

        $$('.user-title').on('click', function () {
            var userTitle = pagedata.data0.postname;
            myApp.modal({
                title: '职称信息',
                text: '',
                afterText: '<div class="modal-input-wrap"><input type="text" class="modal-text-input" id="updatepostname" value="' + userTitle + '"><i class="clear-value iconfont icon-shanchu"></i></div>',
                buttons: [
                {
                    text: '取消'
                },
                {
                    text: '确定',
                    bold: true,
                    onClick: function () {
                        $.Frame.Ajax.Ajax({
                            url: $.Frame.Config.Constant.ServerUrl + "doctor.savedoctorpostname.go",
                            postdata: {
                                doctorsno:localStorage.getItem("doctorSno"),
                                //doctorsno: "1fc0aa39-cd6b-4786-b078-8b4c59cebdc3"
                                updatepostname: $("#updatepostname").val()
                            },
                            success: function (rtn) {
                                //发送成功
                                if (rtn.issuccess) {
                                    $("#postname").text($("#updatepostname").val());
                                } else {
                                    myApp.alert("修改失败!", "提示");
                                }
                            },
                            async: true
                        })
                    }
                }]
            });
            $$('.modal-input-wrap .clear-value').on('click', function () {
                $$(this).prev().val('');
            });
        });
        </script>
    </body>
    </html>