
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>聚美医</title>
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1453083508_4721825.css">
    <link rel="stylesheet" href="css/framework7.ios.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="css/my-app.css">
    <link rel="stylesheet" href="css/yangjie.css" />
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="img/android-chrome-192x192.png" sizes="192x192">
    <meta name="msapplication-square70x70logo" content="img/smalltile.png">
    <meta name="msapplication-square150x150logo" content="img/mediumtile.png">
    <meta name="msapplication-wide310x150logo" content="img/widetile.png">
    <meta name="msapplication-square310x310logo" content="img/largetile.png">
</head>
<body>
    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar-overlay"></div>
    <!-- Views-->
    <div class="views">
        <!-- Your main view, should have "view-main" class-->
        <div class="view view-main">
            <!-- Top Navbar-->
            <div class="navbar">
                <div class="navbar-inner">
                    <div class="left"><a href="javascript:history.go(-1)" class="form-back link"><i class="icon icon-back"></i></a></div>
                    <div class="center sliding">擅长项目</div>
                    <div class="right"><a href="#" class="link goodat-save">保存</a></div>
                </div>
            </div>
            <div class="pages navbar-through">
                <div data-page="goodat" class="page">
                    <div class="page-content" style="padding-top:0px">
                        <div class="goodat-list">
                        </div>
                        <div class="item">
                            <p>没有找到？可以在这里填写您的擅长项目</p>
                            <div class="goodat-input">
                                <textarea id="doctorinput" rows="3" placeholder="输入您的擅长项目"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/framework7.min.js"></script>
    <!-- Path to your app js-->
    <script type="text/javascript" src="js/my-app.js"></script>

    <script src="Scripts/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="Scripts/jquery.tmpl.min.js"></script>
    <script src="Scripts/FrameJs/global.js"></script>
    <script src="Scripts/FrameJs/frame.ajax2.js"></script>
    <script type="text/x-jquery-tmpl" id="datalist">
        <div class="item">
            <div class="list-title"><i class="iconfont ${typeicon}"></i>${typename}</div>
            <ul class="clearfix">
                {{each(i,arg) items}}
                {{if i==8}}
                <li class="view-more"><i class="iconfont icon-shuangjianxia"></i></li>
                <li onclick="tobaike('${arg.sno}')" data-isactive="${arg.isactive}"><font size="1" color="black">${arg.name}</font></li>
                {{else}}
                <li onclick="tobaike('${arg.sno}')" data-isactive="${arg.isactive}"><font size="1" color="black">${arg.name}</font></li>
                {{/if}}
                {{/each}}
            </ul>
        </div>
    </script>
    <script type="text/javascript">
        var myApp = new Framework7();
        // Export selectors engine
        var $$ = Dom7;
        var prodata;
        window.onload = function () {
            $.Frame.Ajax.Ajax({
                url: $.Frame.Config.Constant.ServerUrl + "baike.loadpro.go",
                postdata: {
                    //doctorsno: "1fc0aa39-cd6b-4786-b078-8b4c59cebdc3"
                    doctorsno: localStorage.getItem("doctorSno")
                },
                success: function (rtn) {
                    if (rtn.issuccess) {
                        //对rtn.data中的items进行处理,为它加一个标记,
                        //并在模板中进行判断

                        for (var i = 0, item; item = rtn.data[i], i < rtn.data.length; i++) {
                            console.log("item:" + item);
                            for (var j = 0, list; list = item.items[j], j < rtn.data[i].items.length; j++) {
                                for (var k = 0, orderitem; orderitem = rtn.orderdata[k], k < rtn.orderdata.length; k++) {
                                    if (orderitem.sno == list.sno) {
                                        rtn.data[i].items[j].isactive = true;
                                        console.log(rtn.data[i].items[j]);

                                    }
                                }

                            }
                        }

                        $(".goodat-list").empty();
                        $("#datalist").tmpl(rtn.data).appendTo(".goodat-list");
                        $("[data-isactive=true]").addClass("active");

                        //console.log($("[data-isactive]").text());
                        //$("[data-isactive]").addClass("active");
                        ////console.log($("[data-isactive]").each(function () { console.log($(this).text()+" :class:"+$(this).attr("class"));}));

                        $('.goodat-list ul').each(function () {
                            $(this).find('.view-more').nextAll().hide();
                        });
                        $('.goodat-list ul li.view-more').click(function () {
                            $(this).nextAll().show();
                            $(this).remove();
                        });
                        $("ul.clearfix li").click(function () {
                            $(this).toggleClass("active");
                        });
                    } else {
                        $.Frame.Message.ShowMsg(rtn.msg);
                    }
                }
            })
        }

        $$('.goodat-save').on('click', function () {
            var docinputpro = $("#doctorinput").val();
            var arr = [];
            if ($(".active").length > 10) {
                myApp.alert("您最多只能选择10个擅长项目");
                return;
            }

            $(".active").each(function (index) {
                arr.push($(this).text());
            });
            var orderprodata = arr.join(",");
            console.log(orderprodata);
            myApp.confirm('', '是否保存编辑？',
                function () {
                    // myApp.alert('已保存');
                    $.Frame.Ajax.Ajax({
                        url: $.Frame.Config.Constant.ServerUrl + "baike.editdocpro.go",
                        postdata: {
                            //doctorsno: "1fc0aa39-cd6b-4786-b078-8b4c59cebdc3",
                            doctorsno: localStorage.getItem("doctorSno"),
                            orderprodata: orderprodata,
                            docinputpro: docinputpro
                        },
                        success: function (rtn) {
                            if (rtn.issuccess) {
                                //给提示
                                myApp.alert('您的擅长项目已提交,包含的自定义项我们会尽快为您审核');


                            } else {
                                $.Frame.Message.ShowMsg(rtn.msg);
                            }
                        }
                    })

                    view4.router.back();
                },
                function () {
                    view4.router.back();
                }
            );
        });
    </script>
</body>
</html>